function MapboxLanguage(a){if(a=Object.assign({},a),!(this instanceof MapboxLanguage))throw new Error('MapboxLanguage needs to be called with the new keyword');this.setLanguage=this.setLanguage.bind(this),this._initialStyleUpdate=this._initialStyleUpdate.bind(this),this._defaultLanguage=a.defaultLanguage,this._isLanguageField=a.languageField||/^\{name/,this._getLanguageField=a.getLanguageField||function(a){return a==='mul'?'{name}':'{name_'+a+'}'},this._languageSource=a.languageSource||null,this._languageTransform=a.languageTransform||function(a,b){return b==='ar'?noSpacing(a):standardSpacing(a)},this._excludedLayerIds=a.excludedLayerIds||[],this.supportedLanguages=a.supportedLanguages||['ar','en','es','fr','de','ja','ko','mul','pt','ru','zh']}function standardSpacing(a){var b=a.layers.map(function(a){if(!(a.layout||{})['text-field'])return a;var b=0;return a['source-layer']==='state_label'&&(b=.15),a['source-layer']==='marine_label'&&(/-lg/.test(a.id)&&(b=.25),/-md/.test(a.id)&&(b=.15),/-sm/.test(a.id)&&(b=.1)),a['source-layer']==='place_label'&&(/-suburb/.test(a.id)&&(b=.15),/-neighbour/.test(a.id)&&(b=.1),/-islet/.test(a.id)&&(b=.01)),a['source-layer']==='airport_label'&&(b=.01),a['source-layer']==='rail_station_label'&&(b=.01),a['source-layer']==='poi_label'&&/-scalerank/.test(a.id)&&(b=.01),a['source-layer']==='road_label'&&(/-label-/.test(a.id)&&(b=.01),/-shields/.test(a.id)&&(b=.05)),Object.assign({},a,{layout:Object.assign({},a.layout,{'text-letter-spacing':b})})});return Object.assign({},a,{layers:b})}function noSpacing(a){var b=a.layers.map(function(a){if(!(a.layout||{})['text-field'])return a;var b=0;return Object.assign({},a,{layout:Object.assign({},a.layout,{'text-letter-spacing':b})})});return Object.assign({},a,{layers:b})}function isNameStringField(b,a){return typeof a=='string'&&b.test(a)}function isNameFunctionField(b,a){return a.stops&&a.stops.filter(function(a){return b.test(a[1])}).length>0}function adaptPropertyLanguage(b,a,c){if(isNameStringField(b,a))return c;if(isNameFunctionField(b,a)){var d=a.stops.map(function(a){return b.test(a[1])?[a[0],c]:a});return Object.assign({},a,{stops:d})}return a}function changeLayerTextProperty(b,a,c,d){return a.layout&&a.layout['text-field']&&d.indexOf(a.id)===-1?Object.assign({},a,{layout:Object.assign({},a.layout,{'text-field':adaptPropertyLanguage(b,a.layout['text-field'],c)})}):a}function findStreetsSource(a){var b=Object.keys(a.sources).filter(function(b){var c=a.sources[b];return/mapbox-streets-v\d/.test(c.url)});return b[0]}MapboxLanguage.prototype.setLanguage=function(a,b){var c,d,e,f,g,h;if(this.supportedLanguages.indexOf(b)<0)throw new Error('Language '+b+' is not supported');return c=this._languageSource||findStreetsSource(a),!c?a:(d=this._getLanguageField(b),e=this._isLanguageField,f=this._excludedLayerIds,g=a.layers.map(function(a){return a.source===c?changeLayerTextProperty(e,a,d,f):a}),h=Object.assign({},a,{layers:g}),this._languageTransform(h,b))},MapboxLanguage.prototype._initialStyleUpdate=function(){var a=this._map.getStyle(),b=this._defaultLanguage||browserLanguage(this.supportedLanguages);this._map.off('styledata',this._initialStyleUpdate),this._map.setStyle(this.setLanguage(a,b))};function browserLanguage(d){var b=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,c=b.split('-'),a=b;return c.length>1&&(a=c[0]),d.indexOf(a)>-1?a:null}MapboxLanguage.prototype.onAdd=function(a){return this._map=a,this._map.on('styledata',this._initialStyleUpdate),this._container=document.createElement('div'),this._container},MapboxLanguage.prototype.onRemove=function(){this._map.off('styledata',this._initialStyleUpdate),this._map=void 0};function ie11Polyfill(){typeof Object.assign!='function'&&Object.defineProperty(Object,'assign',{value:function(e,f){'use strict';var d,c,a,b;if(e===null)throw new TypeError('Cannot convert undefined or null to object');d=Object(e);for(c=1;c<arguments.length;c++)if(a=arguments[c],a!==null)for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&(d[b]=a[b]);return d},writable:!0,configurable:!0})}typeof module!='undefined'&&typeof module.exports!='undefined'?module.exports=MapboxLanguage:(ie11Polyfill(),window.MapboxLanguage=MapboxLanguage)