<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>一文学完《Effective Objective-C 2.0》 &#183; 一个技术宅的碎碎念</title><meta name=title content="一文学完《Effective Objective-C 2.0》 &#183; 一个技术宅的碎碎念"><link rel=canonical href=https://ryderfang.com/posts/2022/effective-oc-2.0/><link type=text/css rel=stylesheet href=/css/main.bundle.min.dad1b12325f7c3b44ad9c0d8067355f25810caa10211e22eb73350c24e042ebbb765ca20078335394f8497638dcec36e2d78bfea538ef059bcc1084d0f1950d5.css integrity="sha512-2tGxIyX3w7RK2cDYBnNV8lgQyqECEeIutzNQwk4ELru3ZcogB4M1OU+El2ONzsNuLXi/6lOO8Fm8wQhNDxlQ1Q=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.834d6b4d9147f0358db730e32000d6cfe107f549babe2a7c97cac37b88630d9bd03f55e5606dfa6295d68bbda40afe6c5be61df52bff647b406a8b716ad0ae95.js integrity="sha512-g01rTZFH8DWNtzDjIADWz+EH9Um6vip8l8rDe4hjDZvQP1XlYG36YpXWi72kCv5sW+Yd9Sv/ZHtAaotxatCulQ==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="一文学完《Effective Objective-C 2.0》"><meta property="og:description" content="查了下订单，这本书买了 4 年多，还没看完！"><meta property="og:type" content="article"><meta property="og:url" content="https://ryderfang.com/posts/2022/effective-oc-2.0/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-07T21:23:42+08:00"><meta property="article:modified_time" content="2022-04-07T21:23:42+08:00"><meta property="og:site_name" content="一个技术宅的碎碎念"><meta name=twitter:card content="summary"><meta name=twitter:title content="一文学完《Effective Objective-C 2.0》"><meta name=twitter:description content="查了下订单，这本书买了 4 年多，还没看完！"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"碎语闲言","name":"一文学完《Effective Objective-C 2.0》","headline":"一文学完《Effective Objective-C 2.0》","abstract":"查了下订单，这本书买了 4 年多，还没看完！","inLanguage":"en","url":"https:\/\/ryderfang.com\/posts\/2022\/effective-oc-2.0\/","author":{"@type":"Person","name":"Ryder Fang"},"copyrightYear":"2022","dateCreated":"2022-04-07T21:23:42\u002b08:00","datePublished":"2022-04-07T21:23:42\u002b08:00","dateModified":"2022-04-07T21:23:42\u002b08:00","keywords":["objc"],"mainEntityOfPage":"true","wordCount":"826"}]</script><meta name=generator content="Hugo 0.110.0"><meta name=author content="Ryder Fang"><link href=mailto:fr9166@gmail.com rel=me><link href=https://github.com/ryderfang rel=me><link href=https://twitter.com/ryderfang rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a href=/><img src=/img/logo.png width=200 height=108 class="max-w-[10rem] max-h-[10rem] object-scale-down object-left" alt=一个技术宅的碎碎念></a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/leetcode/ title=算法专栏>Algorithms</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=碎语闲言>Articles</a></li><li class="ltr:text-right rtl:text-left ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></li></ul></nav></header><main id=main-content class="relative grow"><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">一文学完《Effective Objective-C 2.0》</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-04-07 21:23:42 +0800 +0800">April 7 2022</time><span class="px-2 text-primary-500">&#183;</span><span>826 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">4 mins<span class="px-2 text-primary-500">&#183;</span>
👀 <span id=busuanzi_value_page_pv></span></span></div><div class="my-1 text-xs text-neutral-500 dark:text-neutral-400"><a href=/categories/tech/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">Tech</a>
<a href=/categories/article/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">Article</a></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#基础概念>基础概念</a><ul><li><a href=#1-起源>1. 起源</a></li><li><a href=#2-减少头文件引用>2. 减少头文件引用</a></li><li><a href=#3-字面量语法糖与下标操作>3. 字面量语法糖与下标操作</a></li><li><a href=#4-用-const-常量代替-define>4. 用 const 常量代替 #define</a></li><li><a href=#5-使用枚举>5. 使用枚举</a></li></ul></li><li><a href=#对象消息与运行时>对象、消息与运行时</a><ul><li><a href=#6-属性>6. 属性</a></li><li><a href=#7-在对象中尽量直接访问实例变量>7. 在对象中尽量直接访问实例变量</a></li><li><a href=#8-对象相等性>8. 对象相等性</a></li><li><a href=#9-类族>9. 类族</a></li><li><a href=#10-关联对象>10. 关联对象</a></li><li><a href=#11-消息发送>11. 消息发送</a></li><li><a href=#12-消息转发>12. 消息转发</a></li><li><a href=#13-黑魔法>13. 黑魔法</a></li><li><a href=#14-类对象>14. 类对象</a></li></ul></li><li><a href=#接口与-api>接口与 api</a><ul><li><a href=#15-使用前缀命名>15. 使用前缀命名</a></li><li><a href=#16-使用指定初始化方法>16. 使用指定初始化方法</a></li><li><a href=#17-实现-description-方法>17. 实现 description 方法</a></li><li><a href=#18-尽量使用不可变对象>18. 尽量使用不可变对象</a></li><li><a href=#19-命名>19. 命名</a></li><li><a href=#20-私有方法加前缀->20. 私有方法加前缀 ️❓</a></li><li><a href=#21-处理异常>21. 处理异常</a></li><li><a href=#22-理解-nscopying>22. 理解 NSCopying</a></li></ul></li><li><a href=#协议与分类>协议与分类</a><ul><li><a href=#23-委托-delegate>23. 委托 delegate</a></li><li><a href=#24-分类>24. 分类</a></li><li><a href=#25-分类名和方法>25. 分类名和方法</a></li><li><a href=#26-分类中不要定义属性>26. 分类中不要定义属性</a></li><li><a href=#27-匿名类>27. 匿名类</a></li><li><a href=#28-用协议提供匿名对象>28. 用协议提供匿名对象</a></li></ul></li><li><a href=#内存管理>内存管理</a><ul><li><a href=#29-引用计数>29. 引用计数</a></li><li><a href=#30-使用-arc>30. 使用 ARC</a></li><li><a href=#31-dealloc-方法>31. dealloc 方法</a></li><li><a href=#32-异常与内存管理>32. 异常与内存管理</a></li><li><a href=#33-弱引用>33. 弱引用</a></li><li><a href=#34-autoreleasepool-的使用>34. @autoreleasepool 的使用</a></li><li><a href=#35-僵尸对象>35. 僵尸对象</a></li><li><a href=#36-不要使用-retaincount>36. 不要使用 retainCount</a></li></ul></li><li><a href=#block-与-gcd>block 与 GCD</a><ul><li><a href=#37-理解块-block>37. 理解块 block</a></li><li><a href=#38-使用-typedef-重命名-block>38. 使用 typedef 重命名 block</a></li><li><a href=#39-使用-handler-块降低代码分散程度>39. 使用 handler 块降低代码分散程度</a></li><li><a href=#40-block-与-循环引用>40. block 与 循环引用</a></li><li><a href=#41-用队列代替锁>41. 用队列代替锁</a></li><li><a href=#42-用-gcd-替代-performselector>42. 用 GCD 替代 performSelector</a></li><li><a href=#43-gcd-与-nsoperationqueue>43. GCD 与 NSOperationQueue</a></li><li><a href=#44-dispatch_group>44. dispatch_group</a></li><li><a href=#45-dispatch_once>45. dispatch_once</a></li><li><a href=#46-不要使用-dispatch_get_current_queue>46. 不要使用 dispatch_get_current_queue</a></li></ul></li><li><a href=#系统框架>系统框架</a><ul><li><a href=#47-熟悉系统框架>47. 熟悉系统框架</a></li><li><a href=#48-使用块遍历代替-for>48. 使用块遍历代替 for</a></li><li><a href=#49-使用-corefoundation-中的-collection-类>49. 使用 CoreFoundation 中的 collection 类</a></li><li><a href=#50-使用-nscache>50. 使用 NSCache</a></li><li><a href=#51-精简-initialize-和-load-代码>51. 精简 initialize 和 load 代码</a></li><li><a href=#52-nstimer-会-retain-它的-target>52. NSTimer 会 retain 它的 Target</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><div class="!mb-9 text-xl lead"><blockquote><p>查了下订单，这本书买了 4 年多，还没看完！</p></blockquote></div><p><figure><img class="my-0 rounded-md" src=https://ryder-1252249141.cos.ap-shanghai.myqcloud.com/uPic/2022-04-07-book.jpeg alt></figure></p><p>所谓 flag，永远也完不成 😢</p><p>毕其功于一役，这次快速啃完这本书，吸收一些最佳实践。</p><p>这本书完整的书名是 《Effective Objective-C 2.0：编写高质量 iOS 与 OS X 代码的 52 个有效方法》，第一版写作于 2014 年，2017 年重印，距今已经比较长的时间了，那么，</p><blockquote><p>这 52 条规则是不是都还适用呢？</p></blockquote><p>带着这个疑问，快速过一遍！</p><h2 id=基础概念 class="relative group">基础概念 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%9f%ba%e7%a1%80%e6%a6%82%e5%bf%b5 aria-label=Anchor>#</a></span></h2><h3 id=1-起源 class="relative group">1. 起源 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%e8%b5%b7%e6%ba%90 aria-label=Anchor>#</a></span></h3><p>OC 是 C 的超集，是 <code>C + Object</code>。</p><p>OC 的消息发送机制与其他语言的函数调用的区别是：</p><blockquote><p>前者由运行时决定，后者由编译器决定。</p></blockquote><h3 id=2-减少头文件引用 class="relative group">2. 减少头文件引用 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%e5%87%8f%e5%b0%91%e5%a4%b4%e6%96%87%e4%bb%b6%e5%bc%95%e7%94%a8 aria-label=Anchor>#</a></span></h3><p>这个应该所有语言 (严谨点，大部分) 都通用吧，减少模块间耦合，避免过多引用。</p><h3 id=3-字面量语法糖与下标操作 class="relative group">3. 字面量语法糖与下标操作 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%e5%ad%97%e9%9d%a2%e9%87%8f%e8%af%ad%e6%b3%95%e7%b3%96%e4%b8%8e%e4%b8%8b%e6%a0%87%e6%93%8d%e4%bd%9c aria-label=Anchor>#</a></span></h3><p>NSString, NSArray, NSNumber, NSDictionary 使用 @"", @[], @(), @{} 语法创建。</p><p>需要注意的是如果有空对象，字面量会抛异常而 crash，但是 <code>arrayWithObjects:</code> 会截断列表，只取 nil 前的元素。</p><p>而对于 NSArry 和 NSDictionary 来说，下标操作比 <code>objectAtIndex:</code> 和 <code>objectForKey:</code> 要方便一点，
但是越界一样会抛异常。</p><h3 id=4-用-const-常量代替-define class="relative group">4. 用 const 常量代替 #define <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-%e7%94%a8-const-%e5%b8%b8%e9%87%8f%e4%bb%a3%e6%9b%bf-define aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl><span class=c1>// xx.m --&gt; 尽量不要定义在 .h 中，如果是给别人使用，需要 extern
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static</span> <span class=k>const</span> <span class=n>NSTimeInterval</span> <span class=n>kAnimationDuration</span> <span class=o>=</span> <span class=mf>0.3</span>
</span></span><span class=line><span class=cl><span class=c1>// xx.h
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>extern</span> <span class=n>NSString</span> <span class=o>*</span><span class=k>const</span> <span class=n>XXStringConst</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// xx.m
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>NSString</span> <span class=o>*</span><span class=k>const</span> <span class=n>XXStringConst</span> <span class=o>=</span> <span class=s>@&#34;VALUE&#34;</span>
</span></span></code></pre></div><ul><li>const 常量带有类型信息，会被编译器检查；#define 是单纯的字符串替换，没有任何校验。</li><li>extern const 常量只能被定义一次 (可多次声明)，而 #define 没有限制，容易产生覆盖问题。</li><li>tip: static const 定义在 .m 文件中，不会出现在全局符号表中。</li></ul><h3 id=5-使用枚举 class="relative group">5. 使用枚举 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-%e4%bd%bf%e7%94%a8%e6%9e%9a%e4%b8%be aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl><span class=k>typedef</span> <span class=nf>NS_ENUM</span><span class=p>(</span><span class=n>NSInteger</span><span class=p>,</span> <span class=n>XXState</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>XXState1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>XXState2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>XXState3</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>typedef</span> <span class=nf>NS_OPTIONS</span><span class=p>(</span><span class=n>NSInteger</span><span class=p>,</span> <span class=n>XXOPT</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>XXOPT1</span>  <span class=o>=</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>XXOPT2</span>  <span class=o>=</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>XXOPT3</span>  <span class=o>=</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><blockquote><p>switch 中的枚举，不要实现 default 分支，避免新加入枚举值时漏掉分支实现。</p></blockquote><h2 id=对象消息与运行时 class="relative group">对象、消息与运行时 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%af%b9%e8%b1%a1%e6%b6%88%e6%81%af%e4%b8%8e%e8%bf%90%e8%a1%8c%e6%97%b6 aria-label=Anchor>#</a></span></h2><h3 id=6-属性 class="relative group">6. 属性 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#6-%e5%b1%9e%e6%80%a7 aria-label=Anchor>#</a></span></h3><blockquote><p><code>atomic</code> 是原子性的，但并不是线程安全的。</p></blockquote><p>如果在一个线程多次读取某个属性的时候，有另一个线程在写，即使声明为 <code>atomic</code>，也会读取到不同的值。</p><blockquote><p>iOS 中使用同步锁开销较大，一般不使用 <code>atomic</code></p></blockquote><h3 id=7-在对象中尽量直接访问实例变量 class="relative group">7. 在对象中尽量直接访问实例变量 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#7-%e5%9c%a8%e5%af%b9%e8%b1%a1%e4%b8%ad%e5%b0%bd%e9%87%8f%e7%9b%b4%e6%8e%a5%e8%ae%bf%e9%97%ae%e5%ae%9e%e4%be%8b%e5%8f%98%e9%87%8f aria-label=Anchor>#</a></span></h3><ul><li><p>在读取时，使用 <code>_val</code> 而不是 <code>self.val</code></p></li><li><p>在设置时，使用 <code>self.val = xx</code></p></li><li><p>不要在 <code>init</code> 和 <code>dealloc</code> 中使用 <code>self.val</code>！</p><p>如果子类重写了某个属性的 set 方法，</p><ul><li>在 init 中，父类如果调用 set，其实是调用的子类实现，可能会出现不想要的结果</li><li>在 dealloc 中，子类先释放了实例，父类再去调用 set 方法，会导致 crash</li></ul></li></ul><h3 id=8-对象相等性 class="relative group">8. 对象相等性 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#8-%e5%af%b9%e8%b1%a1%e7%9b%b8%e7%ad%89%e6%80%a7 aria-label=Anchor>#</a></span></h3><ul><li><code>==</code>： 是地址比较</li><li><code>isEqual:</code>： 默认也是比较指针，可以被重写。对于 <code>NSString</code>，等效于 <code>isEqualToString:</code></li><li><code>hash</code>：如果对象相等，则 hash 必须相等；反之，不一定成立</li></ul><h3 id=9-类族 class="relative group">9. 类族 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#9-%e7%b1%bb%e6%97%8f aria-label=Anchor>#</a></span></h3><p><code>class cluster</code>，看起来类似于工厂模式。</p><p>系统库的集合类，如 <code>NSArray</code>、<code>NSDictionary</code> 都是类族的抽象基类。</p><h3 id=10-关联对象 class="relative group">10. 关联对象 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#10-%e5%85%b3%e8%81%94%e5%af%b9%e8%b1%a1 aria-label=Anchor>#</a></span></h3><blockquote><p>非必要不要用。</p></blockquote><h3 id=11-消息发送 class="relative group">11. 消息发送 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#11-%e6%b6%88%e6%81%af%e5%8f%91%e9%80%81 aria-label=Anchor>#</a></span></h3><p><code>objc_msgSend</code> 是一个重要的概念。</p><p><code>objc_msgSend</code> 在调用方法时，甚至使用了 &ldquo;尾递归&rdquo; 优化。</p><h3 id=12-消息转发 class="relative group">12. 消息转发 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#12-%e6%b6%88%e6%81%af%e8%bd%ac%e5%8f%91 aria-label=Anchor>#</a></span></h3><p><code>message forwarding</code> 也是一个重要的概念。三步走：</p><ol><li><p><code>+ (BOOL)resolveInstanceMethod:(SEL)sel</code>，可用于动态添加实现</p></li><li><p><code>- (id)forwardingTargetForSelector:(SEL)aSelector</code>，转发给其他对象</p></li><li><p><code>- (void)forwardInvocation:(NSInvocation *)anInvocation</code>，完整的消息转发</p><p>第三步，需要配合</p><p><code>- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</code></p><p>使用。</p></li></ol><h3 id=13-黑魔法 class="relative group">13. 黑魔法 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#13-%e9%bb%91%e9%ad%94%e6%b3%95 aria-label=Anchor>#</a></span></h3><p><code>Method Swizzling</code> 也是一个重要的概念。</p><blockquote><p>不要滥用，难以调试</p></blockquote><h3 id=14-类对象 class="relative group">14. 类对象 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#14-%e7%b1%bb%e5%af%b9%e8%b1%a1 aria-label=Anchor>#</a></span></h3><p>参考：<a href=../class-object-isa/>[Runtime] Class, Object 与 isa</a></p><h2 id=接口与-api class="relative group">接口与 api <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%8e%a5%e5%8f%a3%e4%b8%8e-api aria-label=Anchor>#</a></span></h2><h3 id=15-使用前缀命名 class="relative group">15. 使用前缀命名 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#15-%e4%bd%bf%e7%94%a8%e5%89%8d%e7%bc%80%e5%91%bd%e5%90%8d aria-label=Anchor>#</a></span></h3><p>由于没有名字空间 (namespace) 机制，只能通过加前缀的方式避免符号冲突。</p><blockquote><p>特别注意，要在分类方法名前加前缀</p></blockquote><h3 id=16-使用指定初始化方法 class="relative group">16. 使用指定初始化方法 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#16-%e4%bd%bf%e7%94%a8%e6%8c%87%e5%ae%9a%e5%88%9d%e5%a7%8b%e5%8c%96%e6%96%b9%e6%b3%95 aria-label=Anchor>#</a></span></h3><ul><li>指定初始化方法 (designated initializer, NS_DESIGNATED_INITIALIZER) 必须调用父类的指定初始化方法</li><li>本类的其他初始化方法 (便捷初始化方法，convenience initializer) 必须调用本类指定初始化方法，不能调用父类的</li><li>如果子类有指定初始化方法，则必须实现所有父类的指定初始化方法</li></ul><p><figure><img class="my-0 rounded-md" src=https://ryder-1252249141.cos.ap-shanghai.myqcloud.com/uPic/2022-04-09-o_initializerDelegation01_2x.png alt></figure></p><h3 id=17-实现-description-方法 class="relative group">17. 实现 description 方法 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#17-%e5%ae%9e%e7%8e%b0-description-%e6%96%b9%e6%b3%95 aria-label=Anchor>#</a></span></h3><p>或者 <code>debugDescription</code> 方法，用于调试输出日志。</p><h3 id=18-尽量使用不可变对象 class="relative group">18. 尽量使用不可变对象 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#18-%e5%b0%bd%e9%87%8f%e4%bd%bf%e7%94%a8%e4%b8%8d%e5%8f%af%e5%8f%98%e5%af%b9%e8%b1%a1 aria-label=Anchor>#</a></span></h3><p><code>immutable</code> 也是个重要的概念。</p><blockquote><p>对外的容器属性尽量只读，并提供读写接口。</p></blockquote><h3 id=19-命名 class="relative group">19. 命名 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#19-%e5%91%bd%e5%90%8d aria-label=Anchor>#</a></span></h3><p>前缀 + 驼峰式，尽可能一眼看懂作用的命名。</p><h3 id=20-私有方法加前缀- class="relative group">20. 私有方法加前缀 ️❓ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#20-%e7%a7%81%e6%9c%89%e6%96%b9%e6%b3%95%e5%8a%a0%e5%89%8d%e7%bc%80- aria-label=Anchor>#</a></span></h3><p>作者建议私有方法使用 <code>p_</code> 作为前缀，这点个人觉得存疑。</p><p>实际开发中，没有必要区分 public 和 private 方法。不在头文件中的方法即为 private，
显然使用者有很多办法可以绕过这个限制。但这不重要。</p><p>这里作者提了一点很重要，不要使用 <code>_</code> 单下划线作为前缀，因为系统库也这样命名，容易无意中重载。</p><h3 id=21-处理异常 class="relative group">21. 处理异常 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#21-%e5%a4%84%e7%90%86%e5%bc%82%e5%b8%b8 aria-label=Anchor>#</a></span></h3><blockquote><p>少用异常，除非必须 crash 的场景。一般错误使用 NSError 替代。</p></blockquote><p>这里我要说一句，有些人喜欢 <code>NSAssert</code> 滥用，真是非常影响调试！😒</p><h3 id=22-理解-nscopying class="relative group">22. 理解 NSCopying <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#22-%e7%90%86%e8%a7%a3-nscopying aria-label=Anchor>#</a></span></h3><p><code>immutable</code> 与 <code>mutable</code> 与 <u>深浅拷贝</u> 的概念不要混淆。</p><ul><li><code>copy</code> -> <code>immutable</code></li><li><code>mutableCopy</code> -> <code>mutable</code></li><li><code>[NSArray copy]</code> -> 浅拷贝，即与原数组指针相同</li><li><code>[NSArray mutableCopy], [NSMutableArray copy], [NSMutableArray mutableCopy]</code> 都是深拷贝，会生成新的地址。</li></ul><blockquote><p>对于集合类成员来说，默认都没有执行 copy 操作。</p></blockquote><blockquote><p>可以使用 <code>-initWithXX:copyItems:YES</code> 方法执行逐个 copy。</p></blockquote><h2 id=协议与分类 class="relative group">协议与分类 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%8d%8f%e8%ae%ae%e4%b8%8e%e5%88%86%e7%b1%bb aria-label=Anchor>#</a></span></h2><h3 id=23-委托-delegate class="relative group">23. 委托 delegate <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#23-%e5%a7%94%e6%89%98-delegate aria-label=Anchor>#</a></span></h3><p>Cocoa 框架大量使用，约定俗成的设计模式。</p><h3 id=24-分类 class="relative group">24. 分类 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#24-%e5%88%86%e7%b1%bb aria-label=Anchor>#</a></span></h3><p>将一个大类，按功能拆成多个分类，是一种代码优化的方法。</p><h3 id=25-分类名和方法 class="relative group">25. 分类名和方法 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#25-%e5%88%86%e7%b1%bb%e5%90%8d%e5%92%8c%e6%96%b9%e6%b3%95 aria-label=Anchor>#</a></span></h3><p>在为系统或第三方类添加分类时，要加上自己特有的名字前缀。</p><p>与 <a href=./#15-%E4%BD%BF%E7%94%A8%E5%89%8D%E7%BC%80%E5%91%BD%E5%90%8D>#15</a> 类似。</p><h3 id=26-分类中不要定义属性 class="relative group">26. 分类中不要定义属性 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#26-%e5%88%86%e7%b1%bb%e4%b8%ad%e4%b8%8d%e8%a6%81%e5%ae%9a%e4%b9%89%e5%b1%9e%e6%80%a7 aria-label=Anchor>#</a></span></h3><p>一般也定义不了。除非使用关联对象。</p><h3 id=27-匿名类 class="relative group">27. 匿名类 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#27-%e5%8c%bf%e5%90%8d%e7%b1%bb aria-label=Anchor>#</a></span></h3><p><code>class-continuation</code></p><p>可以用来</p><ul><li>隐藏私有变量</li><li>隐藏私有方法</li><li>隐藏私有协议</li></ul><h3 id=28-用协议提供匿名对象 class="relative group">28. 用协议提供匿名对象 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#28-%e7%94%a8%e5%8d%8f%e8%ae%ae%e6%8f%90%e4%be%9b%e5%8c%bf%e5%90%8d%e5%af%b9%e8%b1%a1 aria-label=Anchor>#</a></span></h3><p>指 <code>id&lt;XXProtocol> delegate</code> 这种形式</p><h2 id=内存管理 class="relative group">内存管理 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86 aria-label=Anchor>#</a></span></h2><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="ltr:pr-3 rtl:pl-3 text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></span></span><span class=dark:text-neutral-300>内存管理对于 OC 来说很重要。</span></div><h3 id=29-引用计数 class="relative group">29. 引用计数 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#29-%e5%bc%95%e7%94%a8%e8%ae%a1%e6%95%b0 aria-label=Anchor>#</a></span></h3><p>对象间引用构成一颗树，根结点是 <code>NSApplication/UIApplication</code>。</p><p><code>autorelease</code> 可以延长变量的生命期，通常用于方法返回。(MRC)</p><h3 id=30-使用-arc class="relative group">30. 使用 ARC <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#30-%e4%bd%bf%e7%94%a8-arc aria-label=Anchor>#</a></span></h3><p>ARC 很好用。但需要注意：</p><ul><li>必要的时候需要借用 autoreleasePool 管理</li><li>CoreFoundation 对象不归 ARC 管，需要自行调用 <code>CFRelease</code></li></ul><h3 id=31-dealloc-方法 class="relative group">31. dealloc 方法 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#31-dealloc-%e6%96%b9%e6%b3%95 aria-label=Anchor>#</a></span></h3><blockquote><p>MRC 中 dealloc 最后需要手动调用 <code>[super dealloc]</code>，ARC 中不再需要</p></blockquote><ul><li>不要在 dealloc 中调用异步操作</li><li>不要在 dealloc 中调用属性的读写操作</li></ul><p>在对象处于 <code>deallocating state</code> 时，不要做修改对象内容的事情。</p><h3 id=32-异常与内存管理 class="relative group">32. 异常与内存管理 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#32-%e5%bc%82%e5%b8%b8%e4%b8%8e%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86 aria-label=Anchor>#</a></span></h3><p>try 块中创建的对象需要在 @finally 中释放。ARC 下需要开启 <code>-fobjc-arc-exceptions</code> 编译标志才可以正确释放。</p><h3 id=33-弱引用 class="relative group">33. 弱引用 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#33-%e5%bc%b1%e5%bc%95%e7%94%a8 aria-label=Anchor>#</a></span></h3><p><code>weak</code> 也是一个重要的概念。</p><p>与 <code>unsafe_unretained</code> 区别在于，<code>weak</code> 会进行 <code>autonilling</code>。</p><h3 id=34-autoreleasepool-的使用 class="relative group">34. @autoreleasepool 的使用 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#34-autoreleasepool-%e7%9a%84%e4%bd%bf%e7%94%a8 aria-label=Anchor>#</a></span></h3><p><code>autorelasePool</code> 也是一个重要的概念。</p><p>降低内存峰值 (high-memeory waterline)</p><h3 id=35-僵尸对象 class="relative group">35. 僵尸对象 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#35-%e5%83%b5%e5%b0%b8%e5%af%b9%e8%b1%a1 aria-label=Anchor>#</a></span></h3><p><code>Zombie Object</code></p><p>Xcode 中有一个开关可以打开 <code>Enable Zombie Objects = YES</code>。</p><p>这样系统会替换 NSObject 的 dealloc 实现。在原类的 dealloc 中，通过 <code>objc_setClass</code>，生成一个 <code>_NSZombie_XXCls</code> 类替换原类，
在后续再向原类发送消息时，就会被转发到僵尸类中，然后输出已经被释放的类名和错误信息。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl><span class=o>***</span> <span class=o>-</span><span class=p>[</span><span class=n>XXCls</span> <span class=n>method</span><span class=p>]</span><span class=o>:</span> <span class=n>message</span> <span class=n>send</span> <span class=n>to</span> <span class=n>deallocated</span> <span class=n>instance</span> <span class=mh>0x7</span><span class=n>xxxx</span>
</span></span></code></pre></div><h3 id=36-不要使用-retaincount class="relative group">36. 不要使用 retainCount <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#36-%e4%b8%8d%e8%a6%81%e4%bd%bf%e7%94%a8-retaincount aria-label=Anchor>#</a></span></h3><ul><li>ARC 下可用，MRC 下不准确。所以是无用的</li><li>存在自动释放池，延迟释放，所以这个值也不准</li><li>系统优化释放行为，可能对象引用计数不会为 0</li></ul><h2 id=block-与-gcd class="relative group">block 与 GCD <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#block-%e4%b8%8e-gcd aria-label=Anchor>#</a></span></h2><p>中文版译为 “块与大中枢派发”，无力吐嘈。</p><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="ltr:pr-3 rtl:pl-3 text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></span></span><span class=dark:text-neutral-300>这两者都非常重要。</span></div><h3 id=37-理解块-block class="relative group">37. 理解块 block <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#37-%e7%90%86%e8%a7%a3%e5%9d%97-block aria-label=Anchor>#</a></span></h3><ul><li>block 也是对象，有自己的引用计数和生命周期管理</li><li>block 是一种代替函数指针的语法结构，核心功能在 <code>void (*)(void *,) invoke</code> 函数指针</li><li>捕获的变量在 block 体内，invoke 将 block 本身传入以便于读取到捕获的变量</li><li>有栈 block、堆 block 和 全局 block，可以通过它的 Isa 指针区别</li></ul><h3 id=38-使用-typedef-重命名-block class="relative group">38. 使用 typedef 重命名 block <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#38-%e4%bd%bf%e7%94%a8-typedef-%e9%87%8d%e5%91%bd%e5%90%8d-block aria-label=Anchor>#</a></span></h3><p>常用的做法</p><h3 id=39-使用-handler-块降低代码分散程度 class="relative group">39. 使用 handler 块降低代码分散程度 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#39-%e4%bd%bf%e7%94%a8-handler-%e5%9d%97%e9%99%8d%e4%bd%8e%e4%bb%a3%e7%a0%81%e5%88%86%e6%95%a3%e7%a8%8b%e5%ba%a6 aria-label=Anchor>#</a></span></h3><ul><li>就是将 block 作为参数传入，而不是使用 delegate</li></ul><blockquote><p>这个完全取决于实际情况，如果回调过多，还是 delegate 更好一点。</p></blockquote><ul><li><p>API 设计常用同一个 block 返回结果和错误</p></li><li><p><code>NSNotificationCenter</code> 的设计值得学习，应该由调用者决定回调的线程</p></li></ul><h3 id=40-block-与-循环引用 class="relative group">40. block 与 循环引用 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#40-block-%e4%b8%8e-%e5%be%aa%e7%8e%af%e5%bc%95%e7%94%a8 aria-label=Anchor>#</a></span></h3><p><code>retain cycle</code> 是个使用 block 时常见的问题</p><p>某个类 retain 的 block 内部如果捕获了类本身，就会出现循环引用。此时需要及时释放 block。</p><h3 id=41-用队列代替锁 class="relative group">41. 用队列代替锁 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#41-%e7%94%a8%e9%98%9f%e5%88%97%e4%bb%a3%e6%9b%bf%e9%94%81 aria-label=Anchor>#</a></span></h3><ul><li>使用串行队列代替 <code>@synchronized(self)</code></li><li>串行队列，读同步 <code>dispatch_sync</code>；写异步 <code>dispatch_async</code>，执行速度快，但性能会比同步慢，因为需要 copy block</li><li>并发队列，读同步，写异步，此时避免竞争需要用 <code>dispatch_barrier_async</code>，<strong>栅栏</strong></li></ul><blockquote><p>到底什么是线程安全，很难有个准确的定义。锁机制能保证一定程度的 <code>thread safety</code>，但不绝对。</p></blockquote><p>两次读之间，有写操作。这两次读的结果就可能不一样。这样算不算线程不安全？</p><h3 id=42-用-gcd-替代-performselector class="relative group">42. 用 GCD 替代 performSelector <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#42-%e7%94%a8-gcd-%e6%9b%bf%e4%bb%a3-performselector aria-label=Anchor>#</a></span></h3><ul><li><code>performSelector</code> 无法让编译器决定是否释放返回对象，容易内存泄露</li><li>使用 <code>dispatch_after</code> 代码 <code>performSelector:withObject:afterDelay:</code></li></ul><h3 id=43-gcd-与-nsoperationqueue class="relative group">43. GCD 与 NSOperationQueue <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#43-gcd-%e4%b8%8e-nsoperationqueue aria-label=Anchor>#</a></span></h3><p><code>NSOperationQueue</code> 底层也是 GCD 实现的。但是相对来说，有一些优点：</p><ul><li>更方便取消</li><li>可以指定依赖关系</li><li>可以用 KVO 了解运行状态</li><li>指定操作的优先级</li><li>代码可复用</li></ul><h3 id=44-dispatch_group class="relative group">44. dispatch_group <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#44-dispatch_group aria-label=Anchor>#</a></span></h3><p>掌握几个方法的使用</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl><span class=n>dispatch_group_async</span><span class=p>(</span><span class=n>dispatch_group_t</span> <span class=n>group</span><span class=p>,</span> <span class=n>dispatch_queue_t</span> <span class=n>queue</span><span class=p>,</span> <span class=n>dispatch_block_t</span> <span class=n>block</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 成对出现
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>dispatch_group_enter</span><span class=p>(</span><span class=n>dispatch_group_t</span> <span class=n>group</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>dispatch_group_leave</span><span class=p>(</span><span class=n>dispatch_group_t</span> <span class=n>group</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 阻塞等结束或超时
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>dispatch_group_wait</span><span class=p>(</span><span class=n>dispatch_group_t</span> <span class=n>group</span><span class=p>,</span> <span class=n>dispatch_time_t</span> <span class=n>timeout</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 不阻塞等结束
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>dispatch_group_notify</span><span class=p>(</span><span class=n>dispatch_group_t</span> <span class=n>group</span><span class=p>,</span> <span class=n>dispatch_queue_t</span> <span class=n>queue</span><span class=p>,</span> <span class=n>dispatch_block_t</span> <span class=n>block</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 循环执行多次
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>dispatch_apply</span><span class=p>(</span><span class=n>size_t</span> <span class=n>interations</span><span class=p>,</span> <span class=n>dispatch_queue_t</span> <span class=n>queue</span><span class=p>,</span> <span class=kt>void</span> <span class=p>(</span><span class=o>^</span><span class=n>block</span><span class=p>)(</span><span class=n>size_t</span><span class=p>));</span>
</span></span></code></pre></div><h3 id=45-dispatch_once class="relative group">45. dispatch_once <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#45-dispatch_once aria-label=Anchor>#</a></span></h3><blockquote><p><code>dispatch_one</code> 性能是 <code>@synchronized</code> 的两倍以上</p></blockquote><h3 id=46-不要使用-dispatch_get_current_queue class="relative group">46. 不要使用 dispatch_get_current_queue <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#46-%e4%b8%8d%e8%a6%81%e4%bd%bf%e7%94%a8-dispatch_get_current_queue aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>API_DEPRECATED</span><span class=p>(</span><span class=s>&#34;unsupported interface&#34;</span><span class=p>,</span> <span class=n>macos</span><span class=p>(</span><span class=mf>10.6</span><span class=p>,</span><span class=mf>10.9</span><span class=p>),</span> <span class=n>ios</span><span class=p>(</span><span class=mf>4.0</span><span class=p>,</span><span class=mf>6.0</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>DISPATCH_EXPORT</span> <span class=n>DISPATCH_PURE</span> <span class=n>DISPATCH_WARN_RESULT</span> <span class=n>DISPATCH_NOTHROW</span>
</span></span><span class=line><span class=cl><span class=n>dispatch_queue_t</span>
</span></span><span class=line><span class=cl><span class=n>dispatch_get_current_queue</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span></code></pre></div><p>这个 API 已经被弃用，不过理解其不可用的原因还是有用的。</p><ul><li>返回值通常与预期不符，队列按层级组织，无法用单个队列描述当前队列。如在全局队列中 async 执行某个队列，当前队列可能是全局队列</li><li>可以使用 <code>dispatch_queue_set_specific()</code> 方法存储队列特有数据，类似于 TLS (Thread Local Storage)</li></ul><h2 id=系统框架 class="relative group">系统框架 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%b3%bb%e7%bb%9f%e6%a1%86%e6%9e%b6 aria-label=Anchor>#</a></span></h2><h3 id=47-熟悉系统框架 class="relative group">47. 熟悉系统框架 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#47-%e7%86%9f%e6%82%89%e7%b3%bb%e7%bb%9f%e6%a1%86%e6%9e%b6 aria-label=Anchor>#</a></span></h3><ul><li>Foundation 与 CoreFoundation 存在 “无缝桥接”，如 NString &lt;-> CFString</li><li>常用系统库<ul><li>CFNetwork</li><li>CoreAudio</li><li>AVFoundation</li><li>CoreData</li><li>CoreText</li><li>QuartzCore/CoreAnimation</li><li>CoreGraphics</li></ul></li></ul><h3 id=48-使用块遍历代替-for class="relative group">48. 使用块遍历代替 for <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#48-%e4%bd%bf%e7%94%a8%e5%9d%97%e9%81%8d%e5%8e%86%e4%bb%a3%e6%9b%bf-for aria-label=Anchor>#</a></span></h3><ul><li>for&mldr;in 语法</li><li><code>enumerateObjectsUsingBlock:</code></li></ul><h3 id=49-使用-corefoundation-中的-collection-类 class="relative group">49. 使用 CoreFoundation 中的 collection 类 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#49-%e4%bd%bf%e7%94%a8-corefoundation-%e4%b8%ad%e7%9a%84-collection-%e7%b1%bb aria-label=Anchor>#</a></span></h3><p>这一节感觉不是太常用。</p><ul><li>NSArray -> CFArrayRef: 使用 (__bridge CFArrayRef) 转换</li><li>反之使用 (__bridge_transfer NSMutableDictionary *)(CFMutableDictionaryRef xx)</li></ul><h3 id=50-使用-nscache class="relative group">50. 使用 NSCache <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#50-%e4%bd%bf%e7%94%a8-nscache aria-label=Anchor>#</a></span></h3><p>相比于 NSDictionary 的优势在于：</p><ul><li>键不需要支持 copy</li><li>低内存时自动清理</li><li>线程安全</li><li>配合 NSPurgeableData 使用，实现自动清除数据</li></ul><h3 id=51-精简-initialize-和-load-代码 class="relative group">51. 精简 initialize 和 load 代码 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#51-%e7%b2%be%e7%ae%80-initialize-%e5%92%8c-load-%e4%bb%a3%e7%a0%81 aria-label=Anchor>#</a></span></h3><ul><li><p>load 方法在启动时调用，先调用本类的，再调用分类的。先调用父类的，再调用子类的。子类不实现，父类不会调用。</p></li><li><p>load 中使用其他类是不安全的</p></li><li><p>尽量在 initialize 方法中做初始化操作，与 load 的区别：</p><ul><li>惰性调用，使用时才调用</li><li>比 load 更可靠，此时使用其他类是线程安全的</li><li>遵循继承规则，子类没有实现，会调用父类的</li></ul></li><li><p>也尽量不要在 initialize 中添加太多代码</p></li></ul><h3 id=52-nstimer-会-retain-它的-target class="relative group">52. NSTimer 会 retain 它的 Target <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#52-nstimer-%e4%bc%9a-retain-%e5%ae%83%e7%9a%84-target aria-label=Anchor>#</a></span></h3><blockquote><p>NSTimer 也是一个重要的对象</p></blockquote><p>有多种方法可以打破循环引用 。</p><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="ltr:pr-3 rtl:pl-3 text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></span></span><span class=dark:text-neutral-300>终于看完了！这是一本不错的书，但由于年代久远，一些概念和用法需要更新。</span></div><p>OC 这个古老的语言，如今在大厂的 <code>屎山</code> 项目中还在发挥着作用。</p><p>但是作为开发者，我们要拥抱未来！</p><blockquote><p>To Learn Swift, right now !!</p></blockquote></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><img class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full" width=96 height=96 alt=Author src=/img/avatar_hucbe3027142960c927e09758c3eb1aef3_157400_192x192_fill_box_smart1_3.png><div class=place-self-center><div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Ryder Fang</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Weakness and ignorance are not barriers to survival, but arrogance is.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:fr9166@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/ryderfang target=_blank aria-label=Github rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/ryderfang target=_blank aria-label=Twitter rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a></div></div></div></div><script src=https://utteranc.es/client.js repo=ryderfang/ryderfang.github.io issue-term=title label=blog theme=preferred-color-scheme crossorigin=anonymous async></script><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/posts/2022/git-rebase/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">关于 Rebase 容易被坑的那些事</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-03-19 15:16:29 +0800 +0800">March 19 2022</time></span></span></a></span>
<span><a class="flex text-right group" href=/posts/2022/reduce-pkg-size-1/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">一个神奇的减包方法</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-04-08 17:03:29 +0800 +0800">April 8 2022</time></span></span>
<span class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-[-5.5rem]"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><div id=search-wrapper class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible" data-url=https://ryderfang.com/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts#posts title>⌜查看更多⌟</a></li></ul></nav><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400"></p><p class="text-xs text-neutral-500 dark:text-neutral-400">© 2022 &lt;/>∙
<a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://beian.miit.gov.cn/ target=_blank rel="noopener noreferrer">沪ICP备2021031507号-1</a> ∙</a>
Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a>
∙ PV <u><span id=busuanzi_value_site_pv></span></u> | UV <u><span id=busuanzi_value_site_uv></span></u></p></div><div class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"><button id=appearance-switcher class="w-12 h-12" type=button title="Switch to dark appearance">
<span class="inline dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></span><span class="hidden dark:inline"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></span></button></div></div><style>.links{display:flex;flex-direction:row;justify-content:flex-start;align-items:bottom}.links a{margin:5px;display:flex;flex-direction:column;justify-content:left;align-items:flex-start}.links a img{width:0;height:0}.dark .links a img{filter:brightness(.1)}.links a span{margin-top:0;font-size:.6em;text-decoration:underline}</style><div class=links><a href=https://kalacloud.com/ target=_blank><span class="text-xs text-neutral-500 dark:text-neutral-400">卡拉云</span></a>
<a><span class="text-xs text-neutral-500 dark:text-neutral-400">|</span></a>
<a href=https://github.com/ryderfang target=_blank><span class="text-xs text-neutral-500 dark:text-neutral-400">GitHub</span></a>
<a href=https://apple.com/ target=_blank><span class="text-xs text-neutral-500 dark:text-neutral-400">Apple</span></a>
<a href=https://developer.apple.com/swift/ target=_blank><span class="text-xs text-neutral-500 dark:text-neutral-400">Swift</span></a></div><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></footer></body></html>