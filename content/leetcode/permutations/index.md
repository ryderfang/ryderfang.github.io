---
title: "å…¨æ’åˆ—ç®—æ³•"
date: 2022-05-21T13:20:37+08:00
categories: [Permutations]
tags: []
---

> A permutation is an act of arranging the objects or numbers in order. Combinations are the way of selecting the objects or numbers from a group of objects or collection, in such a way that the order of the objects does not matter.

æ’åˆ—ç»„åˆæ˜¯ç»„åˆ/ç¦»æ•£æ•°å­¦ä¸­çš„åŸºç¡€å’Œé‡è¦çš„æ¦‚å¿µã€‚

{{< katex >}}

$$
  P_n^m = A_n^m = n(n-1)(n-2)...(n-m+1) = \frac {n!}{(n-m)!}
$$

å½“ \\(n = m\\) æ—¶ï¼Œä¹Ÿå°±æ˜¯å…¨æ’åˆ—ï¼š

\\(P_n = n(n-1)(n-2)...3 \times 2 \times 1 = n!\\)

é»˜è®¤æ˜¯ä¸æ”¾å›æ’åˆ—ï¼Œå¦‚æœæ˜¯é‡å¤æ’åˆ—ï¼Œé‚£ä¹ˆæ’åˆ—æ•°å°±æ˜¯ \\(n^m\\)

å“ˆå“ˆï¼Œè·‘åäº†ï¼Œè¿™ç¯‡ä¸æ˜¯è¦æ¼”ç¤º [KaTex çš„ç”¨æ³•](https://katex.org/docs/supported.html) ï¼ˆè™½ç„¶ç¡®å®æŒºæœ‰æ„æ€çš„ ğŸ˜¹ï¼‰

## æ’åˆ—ç®—æ³•

* [46. Permutations](https://leetcode.com/problems/permutations/)
* [31. Next Permutation](https://leetcode.com/problems/next-permutation/)
* [47. Permutations II](https://leetcode.com/problems/permutations-ii/)
* [60. Permutation Sequence](https://leetcode.com/problems/permutation-sequence/)

æˆ‘ä»¬çŸ¥é“æ’åˆ—æ•°æ˜¯é˜¶ä¹˜çº§å¢é•¿ï¼Œ10ä¸ªæ•°çš„æ’åˆ—å°±è¾¾åˆ°äº† \\(10! = 3628800\\)ï¼Œç™¾ä¸‡çº§çš„è§„æ¨¡ã€‚

æ‰€ä»¥ï¼Œå³ä½¿æˆ‘ä»¬ `O(1)` ç”Ÿæˆä¸€ä¸ªæ’åˆ—ï¼Œé‚£ç”Ÿæˆå…¨æ’åˆ—çš„ç®—æ³•å¤æ‚åº¦ä¹Ÿæ˜¯ `O(n!)`ï¼Œéå¸¸ææ€–ã€‚

åœ¨ wiki[^1] ä¸Šæœ‰ä¸€ä¸ªæœ‰æ„æ€çš„å›¾ï¼Œè¡¨ç¤ºäº†ä¹ç§ç®—æ³•ï¼Œç”Ÿæˆå…¨æ’åˆ—çš„é¡ºåºã€‚

![](https://ryder-1252249141.cos.ap-shanghai.myqcloud.com/uPic/2022-05-21-V8zUei.jpg)

> Ordering of all permutations of length \\({\displaystyle n=4}\\) generated by different algorithms. The permutations are color-coded, where 1[â¤ï¸], 2[ğŸ’›], 3[ğŸ’š], 4[ğŸ’™]

è¿™ä¹ç§ç®—æ³•åˆ†åˆ«æ˜¯ï¼š

1. [å­—å…¸åº](#å­—å…¸åº)
2. [é‚»ä½å¯¹æ¢æ³•](#é‚»ä½å¯¹æ¢æ³•)
3. [Heap ç®—æ³•](#heap-ç®—æ³•4)
4. Ehrlich's star-transposition algorithm 
5. Zaks' prefix reversal algorithm
6. Sawada-Williams' algorithm
7. Corbett's algorithm
8. Single-track ordering
9. Single-track Gray code

ä¸‹é¢æ˜¯å‚è€ƒäº†ä¸€äº›ç½‘ç«™[^2]ï¼Œç”¨ Swift å®ç°å¸¸è§çš„å…¨æ’åˆ—ç”Ÿæˆç®—æ³•ã€‚

### å›æº¯æ³•

ä¸»è¦æ€è·¯ï¼šäº¤æ¢ã€æ’åˆ—ã€æ¢å¤

```swift
func permute1(_ nums: [Int]) -> [[Int]] {
    TICK()
    var ans = [[Int]]()
    func _p(_ a: [Int], _ l: Int, _ r: Int) {
        var tmp = a
        if l == r {
            ans.append(a)
            return
        }
        for i in l...r {
            tmp.swapAt(l, i)
            _p(tmp, l + 1, r)
            tmp.swapAt(i, l)
        }
    }
    _p(nums, 0, nums.count - 1)
    TOCK()
    return ans
}
```

### æ’å…¥æ³•

ä¸»è¦æ€è·¯ï¼šå¯¹äº n çš„å…¨æ’åˆ—ï¼Œå°†ç¬¬ n+1 ä¸ªæ•°ï¼Œæ’å…¥åˆ° (0...n) è¿™ n+1 ä¸ªä½ç½®å°±å¯ä»¥å¾—åˆ° n+1 çš„å…¨æ’åˆ—ã€‚

```swift
func permute2(_ nums: [Int]) -> [[Int]] {
    TICK()
    let ans : [[Int]] = nums.reduce([[]], { partialResult, a in
        var nextResult = [[Int]]()
        for lastArray in partialResult {
            let sz = lastArray.count
            // å°† a æ’å…¥åˆ° n-1 æ’åˆ—ä¸­çš„ sz ä¸ªä½ç½®
            for i in (0...sz) {
                // ArraySlice<Int> ç±»å‹
                let temp = lastArray[0..<i] + [a] + lastArray[i..<sz]
                nextResult.append(Array(temp))
            }
        }
        return nextResult
    })
    TOCK()
    return ans
}
```

`reduce` æ˜¯ä¸ªæŒºæœ‰æ„æ€çš„æ–¹æ³•ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯åˆå§‹å€¼ï¼Œä¸€ä¸ªæ˜¯é—­åŒ…ï¼Œé—­åŒ…æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€æ˜¯ä¸Šä¸€æ­¥çš„ç»“æœï¼Œå¦ä¸€ä¸ªæ˜¯åºåˆ—ä¸­çš„å€¼ã€‚

ä¸Šé¢çš„ä»£ç ç­‰ä»·äºï¼š

```swift
var ans : [[Int]] = [[]]
for i in 0..<nums.count {
    var nextResult = [[Int]]()
    for (_, item) in ans.enumerated() {
        let sz = item.count
        // å°† a æ’å…¥åˆ° n-1 æ’åˆ—ä¸­çš„ sz ä¸ªä½ç½®
        for k in (0...sz) {
            // ArraySlice<Int> ç±»å‹
            let temp = item[0..<k] + [nums[i]] + item[k..<sz]
            nextResult.append(Array(temp))
        }
    }
    ans = nextResult
}
```

### å­—å…¸åº

* é¦–æ¬¡å®šä¹‰å…¨å‡åºä¸ºæœ€å°çš„åºåˆ—ï¼Œå…¨é™åºä¸ºæœ€å¤§çš„åºåˆ—ã€‚

* é—®é¢˜å˜æˆä»æœ€å°é€ä¸€ç”Ÿæˆä¸‹ä¸€ä¸ªæ’åˆ—ï¼Œç”Ÿæˆä¸‹ä¸€ä¸ªæ’åˆ—(**nextPermutation**) çš„ç®—æ³•æœ‰å››æ­¥ï¼š

  1. ä»åå‘å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªé€†åºçš„ä½ç½® \\(j\\), å³ \\(p_j < p_{j+1} >= p_{j+2}\\)
  2. é‡æ–°ä»åå‘å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯” \\(p_j\\) å¤§çš„æ•° \\(p_k\\)ï¼Œç”±äº \\([j+1, n)\\) æ˜¯é™åºçš„ (ç¬¬ä¸€æ­¥å†³å®š)ï¼Œ
  \\(k\\) å¿…ç„¶ä¹Ÿæ˜¯æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„æœ€å°çš„æ•°ï¼Œå³ \\(P_k = \min\\{P_i | P_i > P_j, i > j\\}\\)
  3. äº¤æ¢ \\(j\\) å’Œ \\(k\\) ä½ç½®çš„æ•°
  4. å°† \\([j+1, n)\\) åè½¬ (é™åºå˜å‡åºï¼Œå…¶å®å°±æ˜¯é‡æ’åº)

```swift
func permute3(_ nums: [Int]) -> [[Int]] {
    TICK()
    let nextPermutation : ([Int]) -> [Int]? = {
        array in
        var result = array
        let sz = array.count
        var j = -1
        // æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”åé¢æ•°å°çš„æ•°
        for i in (0..<sz-1).reversed() {
            if result[i] < result[i+1] {
                j = i;
                break;
            }
        }
        // æ‰¾ä¸åˆ°è¯´æ˜å·²ç»æ˜¯å…¨é€†åºï¼Œå³æœ€åä¸€ä¸ªæ’åˆ—
        if (j == -1) {
            return nil
        }
        var k = -1
        // æ‰¾åˆ° [j+1, sz) ä¸­æ¯” j å¤§çš„æ•°ä¸­æœ€å°çš„ä¸€ä¸ª k
        // ç¬¬ä¸€ä¸ªå°±æ˜¯æœ€å°çš„ï¼Œå› ä¸º [j+1, sz) æ˜¯é€’å‡çš„
        for i in (j+1..<sz).reversed() {
            if result[i] > result[j] {
                k = i
                break
            }
        }
        // äº¤æ¢ j - k
        result.swapAt(j, k)
        // [j+1, sz)
        result = Array(result[0...j] + result[j+1..<sz].reversed())
        return result
    }
    var ans = [[Int]]()
    ans.append(nums.sorted())
    while let next = nextPermutation(ans.last!) {
        ans.append(next)
    }
    TOCK()
    return ans
}
```

### é€’å½’æ³•

ä¸»è¦æ€è·¯æ˜¯ï¼Œæšä¸¾åŸæ•°ç»„æ‰€æœ‰ä½ç½®ï¼Œå°†ä½ç½®ä¸Šçš„æ•°ç§»åˆ°ç»“æœæ•°ç»„ä¸­ï¼Œç›´åˆ°åŸæ•°ç»„æ¸…ç©ºã€‚

```swift
func permute4(_ nums: [Int]) -> [[Int]] {
    TICK()
    var ans = [[Int]]()
    func _p(_ a: [Int], _ result: [Int]) {
        let sz = a.count
        if sz == 0 {
            ans.append(result)
            return
        }
        for i in 0..<sz {
            let rest = Array(a[0..<i] + a[i+1..<sz])
            _p(rest, result + [a[i]])
        }
    }
    _p(nums, [])
    TOCK()
    return ans
}
```

### é‚»ä½å¯¹æ¢æ³•[^3]

ä¹Ÿå°±æ˜¯ `Steinhausâ€“Johnsonâ€“Trotter` ç®—æ³•ã€‚

// TODOï¼šå¾…è¡¥å……


### Heap ç®—æ³•[^4]



### é€’å¢è¿›ä½æ³•



### é€’å‡è¿›ä½æ³•


### å¿«é€Ÿæ’åˆ—

`QuickPerm` ç®—æ³•[^5]ã€‚


ä»¥ä¸‹æ˜¯é€šè¿‡ `TICK/TOCK` å®ç”Ÿæˆçš„å„ä¸ªç®—æ³•çš„æ‰§è¡Œæ—¶é—´ ï¼ˆä»¥ 10 ä¸ªæ•°æ’åˆ—ä¸ºä¾‹ï¼‰

| ç®—æ³• | æ—¶é—´ |
| -- | -- |
| å›æº¯æ³• | 4.01 s |
| æ’å…¥æ³• | 4.39 s |
| å­—å…¸åº | 8.02 s |
| é€’å½’æ³• | 11.13 s |

> è€—æ—¶ç»Ÿè®¡
```swift
var g_start_time = NSDate()
public func TICK() {
    g_start_time = NSDate()
}
public func TOCK(function: String = #function) {
    print(String(format: "[%@] cost: %.2lf s", function, -g_start_time.timeIntervalSinceNow))
}
```

## å…³äºä¸­ä»‹æ•°[^6]

ä¸­ä»‹æ•°æ˜¯ä¸ºäº†å¿«é€Ÿæ¨å¯¼æŸä¸ªæ’åˆ—çš„ä¸­é—´æ•°ã€‚ä»¥å­—å…¸åºä¸ºä¾‹ï¼Œæˆ‘ä»¬æœ¬æ¥å¯ä»¥ä½¿ç”¨åºå· \\(0,1,2..n!\\) æ¥è¡¨ç¤ºå„ä¸ªæ’åˆ—ã€‚

ä½†ä»è¿™ä¸ªåºå·æ¨å¯¼å‡ºå…·ä½“çš„æ’åˆ—ï¼Œä¸æ˜¯å¾ˆå®¹æ˜“ã€‚æ‰€ä»¥æˆ‘ä»¬å¼•å…¥äº†ä¸­ä»‹æ•°çš„æ¦‚å¿µã€‚

å‡è®¾æ’åˆ— \\(\sigma = (\sigma_1,\sigma_2,\sigma_3,...)\\)ï¼Œå®šä¹‰ä¸­ä»‹æ•°ä¸º \\(L(\sigma) = (L_{n-1}L_{n-2}..L_1)\\)

* \\(L_{n-i}\\) è¡¨ç¤º \\(\sigma_i\\) å³è¾¹æ¯”å®ƒçš„å°çš„æ•°çš„ä¸ªæ•°
* ä¸­ä»‹æ•°æ˜¯ç‰¹æ®Šè¿›åˆ¶è®¾è®¡ï¼Œæœ€ä½ä½æ˜¯ 2 è¿›åˆ¶ï¼Œæ¬¡ä½ä½æ˜¯ 3 è¿›åˆ¶ï¼Œä¾æ¬¡ç±»æ¨ï¼Œå®ƒçš„åè¿›åˆ¶ç»“æœå°±æ˜¯å­—å…¸åºçš„åºå·
* ä¸­ä»‹æ•°çš„è®¡ç®—ï¼š\\(L(\sigma) = L_{n-1}(n-1)! + L_{n-2}(n-2)! + ... + L_1 * 1!\\)
* ä¸€ä¸ª \\(n-1\\) ä½çš„ä¸­ä»‹æ•°ï¼Œå¯ä»¥è¡¨ç¤º \\(n!\\) ä¸ªæ•°å­—ï¼Œæ­£å¥½ä¸æ’åˆ—æ•°å¯¹åº”
* ä¸€ä¸ªä¸­ä»‹æ•°å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„æ’åˆ—ï¼ŒåŒæ ·æ ¹æ®ä¸€ä¸ªæ’åˆ—ä¹Ÿèƒ½æ±‚å‡ºå…¶ä¸­ä»‹æ•°

ä¸­ä»‹æ•°çš„åº”ç”¨ä¸¾ä¾‹ï¼š

> æ±‚æ’åˆ— 83674521 ä¹‹å‰ç¬¬ 2015 ä¸ªæ’åˆ—ã€‚

å¦å¤–ï¼Œåœ¨å‰é¢æåˆ°çš„ [60. Permutation Sequence](https://leetcode.com/problems/permutation-sequence/)

å¦‚æœç›´æ¥éå†ï¼Œæ•ˆç‡ä¸é«˜ã€‚ä½¿ç”¨ä¸­ä»‹æ•°å¯ä»¥ç›´æ¥å¾—åˆ°ç»“æœã€‚

BTW, æ‰¾äº†å¥½ä¹…ï¼Œå‘ç°è¿™ä¸ªæ¦‚å¿µçš„è‹±æ–‡å« [Lehmer Code](https://en.wikipedia.org/wiki/Lehmer_code) - è±é»˜ç¼–ç [^7]

## å…³äºå»é‡



[^1]: https://en.wikipedia.org/wiki/Permutation#Algorithms_to_generate_permutations
[^2]: https://www.baeldung.com/cs/array-generate-all-permutations
[^3]: [Steinhausâ€“Johnsonâ€“Trotter algorithm](https://en.wikipedia.org/wiki/Steinhaus%E2%80%93Johnson%E2%80%93Trotter_algorithm)
[^4]: https://en.wikipedia.org/wiki/Heap%27s_algorithm
[^5]: https://www.quickperm.org/01example.php
[^6]: [å…¨æ’åˆ—ç”Ÿæˆç®—æ³•](https://zh.m.wikipedia.org/zh-cn/%E5%85%A8%E6%8E%92%E5%88%97%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95)
[^7]: https://en.wikipedia.org/wiki/Permutation#Numbering_permutations

