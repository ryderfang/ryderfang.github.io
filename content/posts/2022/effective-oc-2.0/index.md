---
title: "ä¸€æ–‡å­¦å®Œã€ŠEffective Objective-C 2.0ã€‹"
date: 2022-04-07T21:23:42+08:00
categories: [Tech, Article]
tags: [objc]
---

{{< lead >}}

> æŸ¥äº†ä¸‹è®¢å•ï¼Œè¿™æœ¬ä¹¦ä¹°äº† 4 å¹´å¤šï¼Œè¿˜æ²¡çœ‹å®Œï¼

{{< /lead >}}

![](https://ryder-1252249141.cos.ap-shanghai.myqcloud.com/uPic/2022-04-07-book.jpeg)

æ‰€è°“ flagï¼Œæ°¸è¿œä¹Ÿå®Œä¸æˆ ğŸ˜¢

æ¯•å…¶åŠŸäºä¸€å½¹ï¼Œè¿™æ¬¡å¿«é€Ÿå•ƒå®Œè¿™æœ¬ä¹¦ï¼Œå¸æ”¶ä¸€äº›æœ€ä½³å®è·µã€‚

è¿™æœ¬ä¹¦å®Œæ•´çš„ä¹¦åæ˜¯ ã€ŠEffective Objective-C 2.0ï¼šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹ï¼Œç¬¬ä¸€ç‰ˆå†™ä½œäº 2014 å¹´ï¼Œ2017 å¹´é‡å°ï¼Œè·ä»Šå·²ç»æ¯”è¾ƒé•¿çš„æ—¶é—´äº†ï¼Œé‚£ä¹ˆï¼Œ

> è¿™ 52 æ¡è§„åˆ™æ˜¯ä¸æ˜¯éƒ½è¿˜é€‚ç”¨å‘¢ï¼Ÿ

å¸¦ç€è¿™ä¸ªç–‘é—®ï¼Œå¿«é€Ÿè¿‡ä¸€éï¼

## åŸºç¡€æ¦‚å¿µ

### 1. èµ·æº

OC æ˜¯ C çš„è¶…é›†ï¼Œæ˜¯ `C + Object`ã€‚

OC çš„æ¶ˆæ¯å‘é€æœºåˆ¶ä¸å…¶ä»–è¯­è¨€çš„å‡½æ•°è°ƒç”¨çš„åŒºåˆ«æ˜¯ï¼š

> å‰è€…ç”±è¿è¡Œæ—¶å†³å®šï¼Œåè€…ç”±ç¼–è¯‘å™¨å†³å®šã€‚

### 2. å‡å°‘å¤´æ–‡ä»¶å¼•ç”¨

è¿™ä¸ªåº”è¯¥æ‰€æœ‰è¯­è¨€ (ä¸¥è°¨ç‚¹ï¼Œå¤§éƒ¨åˆ†) éƒ½é€šç”¨å§ï¼Œå‡å°‘æ¨¡å—é—´è€¦åˆï¼Œé¿å…è¿‡å¤šå¼•ç”¨ã€‚

### 3. å­—é¢é‡è¯­æ³•ç³–ä¸ä¸‹æ ‡æ“ä½œ

NSString, NSArray, NSNumber, NSDictionary ä½¿ç”¨ @"", @[], @(), @{} è¯­æ³•åˆ›å»ºã€‚

éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæœ‰ç©ºå¯¹è±¡ï¼Œå­—é¢é‡ä¼šæŠ›å¼‚å¸¸è€Œ crashï¼Œä½†æ˜¯ `arrayWithObjects:` ä¼šæˆªæ–­åˆ—è¡¨ï¼Œåªå– nil å‰çš„å…ƒç´ ã€‚

è€Œå¯¹äº NSArry å’Œ NSDictionary æ¥è¯´ï¼Œä¸‹æ ‡æ“ä½œæ¯” `objectAtIndex:` å’Œ `objectForKey:` è¦æ–¹ä¾¿ä¸€ç‚¹ï¼Œ
ä½†æ˜¯è¶Šç•Œä¸€æ ·ä¼šæŠ›å¼‚å¸¸ã€‚

### 4. ç”¨ const å¸¸é‡ä»£æ›¿ #define

```objc
// xx.m --> å°½é‡ä¸è¦å®šä¹‰åœ¨ .h ä¸­ï¼Œå¦‚æœæ˜¯ç»™åˆ«äººä½¿ç”¨ï¼Œéœ€è¦ extern
static const NSTimeInterval kAnimationDuration = 0.3
// xx.h
extern NSString *const XXStringConst;
// xx.m
NSString *const XXStringConst = @"VALUE"
```

* const å¸¸é‡å¸¦æœ‰ç±»å‹ä¿¡æ¯ï¼Œä¼šè¢«ç¼–è¯‘å™¨æ£€æŸ¥ï¼›#define æ˜¯å•çº¯çš„å­—ç¬¦ä¸²æ›¿æ¢ï¼Œæ²¡æœ‰ä»»ä½•æ ¡éªŒã€‚
* extern const å¸¸é‡åªèƒ½è¢«å®šä¹‰ä¸€æ¬¡ (å¯å¤šæ¬¡å£°æ˜)ï¼Œè€Œ #define æ²¡æœ‰é™åˆ¶ï¼Œå®¹æ˜“äº§ç”Ÿè¦†ç›–é—®é¢˜ã€‚
* tip: static const å®šä¹‰åœ¨ .m æ–‡ä»¶ä¸­ï¼Œä¸ä¼šå‡ºç°åœ¨å…¨å±€ç¬¦å·è¡¨ä¸­ã€‚

### 5. ä½¿ç”¨æšä¸¾

```objc
typedef NS_ENUM(NSInteger, XXState) {
    XXState1,
    XXState2,
    XXState3,
};

typedef NS_OPTIONS(NSInteger, XXOPT) {
    XXOPT1  = 1 << 0,
    XXOPT2  = 1 << 1,
    XXOPT3  = 1 << 2,
};
```

> switch ä¸­çš„æšä¸¾ï¼Œä¸è¦å®ç° default åˆ†æ”¯ï¼Œé¿å…æ–°åŠ å…¥æšä¸¾å€¼æ—¶æ¼æ‰åˆ†æ”¯å®ç°ã€‚

## å¯¹è±¡ã€æ¶ˆæ¯ä¸è¿è¡Œæ—¶

### 6. å±æ€§

> `atomic` æ˜¯åŸå­æ€§çš„ï¼Œä½†å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è¯»å–æŸä¸ªå±æ€§çš„æ—¶å€™ï¼Œæœ‰å¦ä¸€ä¸ªçº¿ç¨‹åœ¨å†™ï¼Œå³ä½¿å£°æ˜ä¸º `atomic`ï¼Œä¹Ÿä¼šè¯»å–åˆ°ä¸åŒçš„å€¼ã€‚

> iOS ä¸­ä½¿ç”¨åŒæ­¥é”å¼€é”€è¾ƒå¤§ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ `atomic`

### 7. åœ¨å¯¹è±¡ä¸­å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡

* åœ¨è¯»å–æ—¶ï¼Œä½¿ç”¨ `_val` è€Œä¸æ˜¯ `self.val`
* åœ¨è®¾ç½®æ—¶ï¼Œä½¿ç”¨ `self.val = xx`
* ä¸è¦åœ¨ `init` å’Œ `dealloc` ä¸­ä½¿ç”¨ `self.val`ï¼

    å¦‚æœå­ç±»é‡å†™äº†æŸä¸ªå±æ€§çš„ set æ–¹æ³•ï¼Œ

    + åœ¨ init ä¸­ï¼Œçˆ¶ç±»å¦‚æœè°ƒç”¨ setï¼Œå…¶å®æ˜¯è°ƒç”¨çš„å­ç±»å®ç°ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸æƒ³è¦çš„ç»“æœ
    + åœ¨ dealloc ä¸­ï¼Œå­ç±»å…ˆé‡Šæ”¾äº†å®ä¾‹ï¼Œçˆ¶ç±»å†å»è°ƒç”¨ set æ–¹æ³•ï¼Œä¼šå¯¼è‡´ crash

### 8. å¯¹è±¡ç›¸ç­‰æ€§

* `==`ï¼š æ˜¯åœ°å€æ¯”è¾ƒ
* `isEqual:`ï¼š é»˜è®¤ä¹Ÿæ˜¯æ¯”è¾ƒæŒ‡é’ˆï¼Œå¯ä»¥è¢«é‡å†™ã€‚å¯¹äº `NSString`ï¼Œç­‰æ•ˆäº `isEqualToString:`
* `hash`ï¼šå¦‚æœå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™ hash å¿…é¡»ç›¸ç­‰ï¼›åä¹‹ï¼Œä¸ä¸€å®šæˆç«‹

### 9. ç±»æ—

`class cluster`ï¼Œçœ‹èµ·æ¥ç±»ä¼¼äºå·¥å‚æ¨¡å¼ã€‚

ç³»ç»Ÿåº“çš„é›†åˆç±»ï¼Œå¦‚ `NSArray`ã€`NSDictionary` éƒ½æ˜¯ç±»æ—çš„æŠ½è±¡åŸºç±»ã€‚

### 10. å…³è”å¯¹è±¡

> éå¿…è¦ä¸è¦ç”¨ã€‚

### 11. æ¶ˆæ¯å‘é€

`objc_msgSend` æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µã€‚

`objc_msgSend` åœ¨è°ƒç”¨æ–¹æ³•æ—¶ï¼Œç”šè‡³ä½¿ç”¨äº† "å°¾é€’å½’" ä¼˜åŒ–ã€‚

### 12. æ¶ˆæ¯è½¬å‘

`message forwarding` ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µã€‚ä¸‰æ­¥èµ°ï¼š

1. `+ (BOOL)resolveInstanceMethod:(SEL)sel`ï¼Œå¯ç”¨äºåŠ¨æ€æ·»åŠ å®ç°
2. `- (id)forwardingTargetForSelector:(SEL)aSelector`ï¼Œè½¬å‘ç»™å…¶ä»–å¯¹è±¡
3. `- (void)forwardInvocation:(NSInvocation *)anInvocation`ï¼Œå®Œæ•´çš„æ¶ˆæ¯è½¬å‘

    ç¬¬ä¸‰æ­¥ï¼Œéœ€è¦é…åˆ

    `- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector`     
    
    ä½¿ç”¨ã€‚

### 13. é»‘é­”æ³•

`Method Swizzling` ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µã€‚

> ä¸è¦æ»¥ç”¨ï¼Œéš¾ä»¥è°ƒè¯•

### 14. ç±»å¯¹è±¡

å‚è€ƒï¼š[[Runtime] Class, Object ä¸ isa](../class-object-isa/)

## æ¥å£ä¸ api

## 15. ä½¿ç”¨å‰ç¼€å‘½å



## åè®®ä¸åˆ†ç±»

## å†…å­˜ç®¡ç† 

## block ä¸ GCD

ä¸­æ–‡ç‰ˆè¯‘ä¸º â€œå—ä¸å¤§ä¸­æ¢æ´¾å‘â€ï¼Œæ— åŠ›åå˜ˆã€‚

## ç³»ç»Ÿæ¡†æ¶

